<div class="min-h-screen bg-gray-50 py-8 px-4">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-900 mb-8">Nueva Reserva</h1>

    <form [formGroup]="reservationForm" class="space-y-6">
      <!-- Sección 1: Selección de Restaurante -->
      <mat-card class="p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">1. Seleccionar Restaurante</h2>
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Restaurante</mat-label>
          <mat-select formControlName="restauranteId">
            <mat-option *ngFor="let restaurant of restaurants" [value]="restaurant.id">
              {{ restaurant.nombre }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="reservationForm.get('restauranteId')?.hasError('required')">
            Selecciona un restaurante
          </mat-error>
        </mat-form-field>
      </mat-card>

      <!-- Sección 2: Selección de Zona -->
      <mat-card class="p-6" *ngIf="reservationForm.get('restauranteId')?.value">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">2. Seleccionar Zona</h2>
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Zona</mat-label>
          <mat-select formControlName="zonaId">
            <mat-option *ngFor="let zona of zonas" [value]="zona.id">
              {{ zona.nombre }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="reservationForm.get('zonaId')?.hasError('required')">
            Selecciona una zona
          </mat-error>
        </mat-form-field>

      </mat-card>

      <!-- Sección 3: Fecha y Hora -->
      <mat-card class="p-6" *ngIf="reservationForm.get('zonaId')?.value">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">3. Fecha y Hora</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Fecha</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="fecha" [min]="minDate" (click)="picker.open()">
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="reservationForm.get('fecha')?.hasError('required')">
              Selecciona una fecha
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Hora</mat-label>
            <mat-select formControlName="hora">
              <mat-option *ngFor="let horario of getFilteredHorarios()" [value]="horario">
                {{ horario }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="reservationForm.get('hora')?.hasError('required')">
              Selecciona una hora
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full" *ngIf="reservationForm.get('hora')?.value">
            <mat-label>Hora de salida</mat-label>
            <mat-select formControlName="horaFin">
              <mat-option *ngFor="let horario of getHoraSalidaOptions()" [value]="horario">
                {{ horario }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="reservationForm.get('horaFin')?.hasError('required')">
              Selecciona la hora de salida
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card>

      <!-- Sección 4: Cantidad de Personas -->
      <mat-card class="p-6" *ngIf="reservationForm.get('horaFin')?.value">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">4. Cantidad de Personas</h2>
        
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Personas</mat-label>
          <button mat-icon-button matPrefix type="button" 
                  class="personas-btn"
                  (click)="decrementPersonas()"
                  [disabled]="(reservationForm.get('cantidadPersonas')?.value || 0) <= 1">
            <mat-icon>remove</mat-icon>
          </button>
          <input matInput type="number" formControlName="cantidadPersonas" 
                 class="text-center"
                 min="1" [max]="maxCapacity">
          <button mat-icon-button matSuffix type="button" 
                  class="personas-btn"
                  (click)="incrementPersonas()"
                  [disabled]="(reservationForm.get('cantidadPersonas')?.value || 0) >= maxCapacity">
            <mat-icon>add</mat-icon>
          </button>
        </mat-form-field>

        <p class="text-sm text-gray-600 mt-2">
          Capacidad máxima disponible: {{ maxCapacity }} personas
        </p>

        <mat-error *ngIf="reservationForm.get('cantidadPersonas')?.hasError('max')" class="text-red-500 text-sm mt-2">
          Excede la capacidad máxima de {{ maxCapacity }} personas
        </mat-error>
      </mat-card>

      <!-- Sección 5: Datos del Cliente -->
      <mat-card class="p-6" *ngIf="reservationForm.get('cantidadPersonas')?.valid">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">5. Datos del Cliente</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Nombre</mat-label>
            <input matInput formControlName="nombreCliente">
            <mat-error *ngIf="reservationForm.get('nombreCliente')?.hasError('required')">
              Nombre requerido
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Apellido</mat-label>
            <input matInput formControlName="apellidoCliente">
            <mat-error *ngIf="reservationForm.get('apellidoCliente')?.hasError('required')">
              Apellido requerido
            </mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Teléfono (10 dígitos)</mat-label>
          <input matInput formControlName="telefono" placeholder="1234567890">
          <mat-error *ngIf="reservationForm.get('telefono')?.hasError('required')">
            Teléfono requerido
          </mat-error>
          <mat-error *ngIf="reservationForm.get('telefono')?.hasError('pattern')">
            Debe contener 10 dígitos
          </mat-error>
        </mat-form-field>
      </mat-card>

      <!-- Sección 6: Buscar Mesa -->
      <mat-card class="p-6" *ngIf="isSearchFormValid()">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">6. Buscar Mesa Disponible</h2>
        
        <button mat-raised-button color="primary" type="button" 
                (click)="searchAvailableTable()"
                class="w-full md:w-auto">
          <mat-icon>search</mat-icon>
          Buscar Mesa Disponible
        </button>

        <!-- Resultado de búsqueda -->
        <div *ngIf="searchPerformed" class="mt-4">
          <div *ngIf="assignedMesa" 
               class="bg-green-50 border border-green-200 rounded-lg p-4">
            <div class="flex items-center gap-2 text-green-800">
              <mat-icon class="text-green-600">check_circle</mat-icon>
              <h3 class="font-semibold">Mesa Disponible</h3>
            </div>
            <p class="mt-2 text-gray-700">
              Mesa #{{ assignedMesa.numero }} 
              <span class="text-gray-600">(capacidad: {{ assignedMesa.capacidad }} personas)</span>
            </p>
          </div>

          <div *ngIf="!assignedMesa" 
               class="bg-red-50 border border-red-200 rounded-lg p-4">
            <div class="flex items-center gap-2 text-red-800">
              <mat-icon class="text-red-600">cancel</mat-icon>
              <h3 class="font-semibold">No hay mesas disponibles</h3>
            </div>
            <p class="mt-2 text-gray-700">
              No hay mesas disponibles para esta combinación de fecha y horario/personas.
            </p>
          </div>
        </div>
      </mat-card>

      <!-- Sección 7: Resumen y Confirmación -->
      <mat-card class="p-6" *ngIf="assignedMesa">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">7. Resumen de Reserva</h2>
        
        <div class="bg-gray-50 rounded-lg p-4 space-y-2">
          <div class="flex justify-between">
            <span class="text-gray-600">Restaurante:</span>
            <span class="font-semibold">{{ getRestaurantName(reservationForm.get('restauranteId')?.value) }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Zona:</span>
            <span class="font-semibold">{{ getZonaName(reservationForm.get('zonaId')?.value) }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Fecha:</span>
            <span class="font-semibold">{{ reservationForm.get('fecha')?.value | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Horario:</span>
            <span class="font-semibold">
              {{ reservationForm.get('hora')?.value }} - {{ reservationForm.get('horaFin')?.value }}
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Personas:</span>
            <span class="font-semibold">{{ reservationForm.get('cantidadPersonas')?.value }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Mesa asignada:</span>
            <span class="font-semibold">#{{ assignedMesa.numero }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Cliente:</span>
            <span class="font-semibold">
              {{ reservationForm.get('nombreCliente')?.value }} {{ reservationForm.get('apellidoCliente')?.value }}
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Teléfono:</span>
            <span class="font-semibold">{{ reservationForm.get('telefono')?.value }}</span>
          </div>
        </div>

        <div class="mt-6 flex gap-4">
          <button mat-raised-button color="primary" type="button"
                  (click)="confirmReservation()"
                  [disabled]="!canConfirmReservation()"
                  class="flex-1">
            <mat-icon>check</mat-icon>
            Confirmar Reserva
          </button>

          <button mat-stroked-button type="button"
                  (click)="resetForm()">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
        </div>
      </mat-card>
    </form>
  </div>
</div>
